<Window x:Class="TechSystems.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:TechSystems"
        Title="ТехноСистемы - Аренда ПО" 
        Height="700" Width="1000"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <local:ImagePathConverter x:Key="ImagePathConverter"/>
        <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Шапка -->
            <RowDefinition Height="Auto"/>
            <!-- Панель фильтров (только для менеджера) -->
            <RowDefinition Height="*"/>
            <!-- Список тарифов -->
            <RowDefinition Height="Auto"/>
            <!-- Панель управления (только для менеджера) -->
        </Grid.RowDefinitions>

        <!-- Шапка -->
        <Border Grid.Row="0" Background="#2196F3" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="ТехноСистемы" 
                           Foreground="White" FontSize="18" FontWeight="Bold"
                           VerticalAlignment="Center"/>

                <TextBlock Grid.Column="1" x:Name="txtUserInfo" Text="Гость" 
                           Foreground="White" FontWeight="Bold"
                           HorizontalAlignment="Center" VerticalAlignment="Center"/>

                <Button Grid.Column="2" x:Name="btnLogout" Content="Выйти" 
                        Width="80" Height="30" 
                        Background="#1976D2" Foreground="White"
                        FontWeight="Bold"
                        Click="BtnLogout_Click"/>
            </Grid>
        </Border>

        <!-- Панель фильтров для менеджера (скрыта для гостя) -->
        <Border Grid.Row="1" x:Name="ManagerFilterPanel" 
                Background="#F5F5F5" Padding="10"
                Visibility="Collapsed">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="Поиск:" 
                           FontWeight="Bold" VerticalAlignment="Center" 
                           Margin="0,0,10,0"/>

                <TextBox Grid.Column="1" x:Name="txtSearch" Height="30" 
         VerticalContentAlignment="Center"
         Padding="5"
         TextChanged="TxtSearch_TextChanged">
                    <TextBox.Style>
                        <Style TargetType="TextBox">
                            <Style.Triggers>
                                <Trigger Property="Text" Value="">
                                    <Setter Property="Foreground" Value="Gray"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </TextBox.Style>
                </TextBox>

                <TextBlock Grid.Column="2" Text="Тип услуги:" 
                           FontWeight="Bold" VerticalAlignment="Center" 
                           Margin="20,0,10,0"/>

                <ComboBox Grid.Column="3" x:Name="cmbServiceTypeFilter" Height="30"
                          VerticalContentAlignment="Center"
                          SelectionChanged="CmbServiceTypeFilter_SelectionChanged">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Name}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <Button Grid.Column="5" x:Name="btnResetFilters" Content="Сбросить фильтры" 
                        Width="120" Height="30"
                        Click="BtnResetFilters_Click"/>
            </Grid>
        </Border>

        <!-- ListView с тарифами -->
        <ScrollViewer Grid.Row="2" Margin="10" 
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
            <ItemsControl x:Name="icTariffs" ItemsSource="{Binding}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal" 
                                   HorizontalAlignment="Center"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="#CCCCCC" BorderThickness="1" 
                                CornerRadius="5" Margin="10"
                                Width="280" Height="400">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Style.Triggers>
                                        <!-- Спецпредложение (скидка >15%) -->
                                        <DataTrigger Binding="{Binding IsSpecialOffer}" Value="True">
                                            <Setter Property="Background" Value="#FFD700"/>
                                        </DataTrigger>

                                        <!-- Мало лицензий (<10%) -->
                                        <DataTrigger Binding="{Binding IsFewLicenses}" Value="True">
                                            <Setter Property="Background" Value="#FFB6C1"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>

                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="150"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- Фото тарифа -->
                                <Image Grid.Row="0" 
                                       Source="{Binding PhotoFileName, Converter={StaticResource ImagePathConverter}}"
                                       Stretch="UniformToFill"
                                       Width="280" Height="150"/>

                                <!-- Название -->
                                <TextBlock Grid.Row="1" Text="{Binding Name}" 
                                           FontWeight="Bold" FontSize="14"
                                           Margin="5,5,5,2"
                                           TextWrapping="Wrap"
                                           TextAlignment="Center">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsStartingSoon}" Value="True">
                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>

                                <!-- Тип услуги -->
                                <TextBlock Grid.Row="2" 
                                           Text="{Binding ServiceType.Name}"
                                           FontSize="12" Foreground="#666666"
                                           Margin="5,0,5,2"
                                           TextAlignment="Center"/>

                                <!-- Срок подписки -->
                                <TextBlock Grid.Row="3" 
                                           Text="{Binding SubscriptionMonths, StringFormat='Срок подписки: {0} мес.'}"
                                           FontSize="12"
                                           Margin="5,0,5,2"
                                           TextAlignment="Center"/>

                                <!-- Дата начала -->
                                <TextBlock Grid.Row="4" 
                                           Text="{Binding StartDate, StringFormat='Дата начала: {0:dd.MM.yyyy}'}"
                                           FontSize="12"
                                           Margin="5,0,5,2"
                                           TextAlignment="Center"/>

                                <!-- Стоимость -->
                                <StackPanel Grid.Row="5" Orientation="Horizontal" 
                                            HorizontalAlignment="Center">
                                    <TextBlock Text="Стоимость: " FontSize="12"/>
                                    <TextBlock Text="{Binding FinalPrice, StringFormat='{}{0:N0} руб.'}" 
                                               FontSize="12" FontWeight="Bold"/>
                                </StackPanel>

                                <!-- Скидка -->
                                <StackPanel Grid.Row="6" Orientation="Horizontal" 
                                            HorizontalAlignment="Center" 
                                            Visibility="{Binding Discount, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <TextBlock Text="Скидка: " FontSize="12"/>
                                    <TextBlock Text="{Binding Discount, StringFormat='{}{0}%'}" 
                                               FontSize="12" FontWeight="Bold" Foreground="Red"/>
                                </StackPanel>

                                <!-- Доступные лицензии -->
                                <TextBlock Grid.Row="7" 
                                           Text="{Binding AvailableLicenses, StringFormat='Доступно лицензий: {0}/{1}'}"
                                           FontSize="12"
                                           Margin="5,0,5,2"
                                           TextAlignment="Center"/>

                                <!-- Описание -->
                                <TextBlock Grid.Row="8" 
                                           Text="{Binding Description}"
                                           FontSize="11" FontStyle="Italic"
                                           Margin="5,5,5,5"
                                           TextWrapping="Wrap"
                                           MaxHeight="40"
                                           TextAlignment="Center"/>

                                <!-- Статус "Скоро" если тариф скоро начинает действовать -->
                                <TextBlock Grid.Row="9" 
                                           Text="СКОРО НАЧИНАЕТСЯ!"
                                           FontSize="12" FontWeight="Bold" Foreground="Red"
                                           Margin="5,5,5,5"
                                           HorizontalAlignment="Center"
                                           Visibility="{Binding IsStartingSoon, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Панель управления для менеджера (скрыта для гостя) -->
        <Border Grid.Row="3" Background="#F5F5F5" Padding="10">
            <StackPanel x:Name="ManagerPanel" Orientation="Horizontal" 
                        HorizontalAlignment="Center" Visibility="Collapsed">
                <Button x:Name="btnAddTariff" Content="Добавить тариф" 
                        Width="120" Height="35" Margin="5"
                        Background="#4CAF50" Foreground="White" FontWeight="Bold"
                        Click="BtnAddTariff_Click"/>

                <Button x:Name="btnEditTariff" Content="Редактировать" 
                        Width="120" Height="35" Margin="5"
                        Background="#2196F3" Foreground="White" FontWeight="Bold"
                        Click="BtnEditTariff_Click"/>

                <Button x:Name="btnDeleteTariff" Content="Удалить" 
                        Width="100" Height="35" Margin="5"
                        Background="#F44336" Foreground="White" FontWeight="Bold"
                        Click="BtnDeleteTariff_Click"/>

                <Button x:Name="btnApplications" Content="Заявки" 
                        Width="100" Height="35" Margin="5"
                        Background="#FF9800" Foreground="White" FontWeight="Bold"
                        Click="BtnApplications_Click"/>

                <Button x:Name="btnClients" Content="Клиенты" 
                        Width="100" Height="35" Margin="5"
                        Background="#9C27B0" Foreground="White" FontWeight="Bold"
                        Click="BtnClients_Click"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>